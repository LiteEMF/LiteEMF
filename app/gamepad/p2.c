/* 
*   BSD 2-Clause License
*   Copyright (c) 2022, LiteEMF
*   All rights reserved.
*   This software component is licensed by LiteEMF under BSD 2-Clause license,
*   the "License"; You may not use this file except in compliance with the
*   License. You may obtain a copy of the License at:
*       opensource.org/licenses/BSD-2-Clause
* 
*/

/************************************************************************************************************
**	Description:	
************************************************************************************************************/
#include "hw_config.h"
#include "api/api_log.h"

#ifdef PS_P2_ENCRYPT_ENABLED
/******************************************************************************************************
** Defined
*******************************************************************************************************/

#define dbits 3

#define dcnt (1 << dbits)

#define bits 2048
#define words (bits/32)
#define hwords (words/2)

#define getbit(a, b) ((a[b >> 5] >> (b & 0x1f)) & 1)


#define mul64(a, b) ((unsigned long long)a * (unsigned long long)b)


/******************************************************************************************************
**	public Parameters
*******************************************************************************************************/

/******************************************************************************************************
**	static Parameters
*******************************************************************************************************/


#if 0       //mazong

const unsigned char post[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x7c,0xaf,0x4e,
0x89,0x74,0xcd,0x90,0x42,0x74,0x96,0xbb,0x13,0xaf,0x75,0x6e,0xbf,0x19,0xfa,0x74,
0x32,0x64,0xa1,0xe4,0x79,0x3f,0xd2,0x5d,0xb9,0xce,0x30,0x14,0x0b,0xed,0xb8,0x68,
0x35,0x42,0xd0,0xd7,0x86,0x1c,0xc9,0x58,0x89,0x2f,0xd8,0xb4,0xf7,0x25,0xa4,0x6e,
0xd8,0xe4,0x07,0xd1,0x21,0x84,0x1f,0x18,0x77,0xe1,0x4e,0x2f,0xdd,0x6e,0x3e,0xdb,
0x1e,0x34,0xa8,0x64,0x43,0xab,0xcc,0xf5,0x82,0x82,0x11,0xb8,0x06,0xfe,0x85,0x81,
0x5a,0x35,0x28,0xe5,0x29,0xd7,0x69,0x78,0x3e,0x36,0x70,0x9e,0xc1,0xe3,0xf2,0xfb,
0xb1,0x4f,0xc4,0xf9,0xdd,0xec,0x80,0x04,0xc0,0xe3,0xeb,0xd2,0xa1,0xf1,0x88,0x29,
0x42,0xd6,0xed,0x97,0xe2,0xec,0x38,0x90,0x3f,0xcc,0x45,0x08,0x4f,0x2c,0xa8,0xf2,
0x13,0x8a,0x1d,0x3e,0x11,0xb9,0xe9,0x29,0xdb,0x57,0x59,0xf2,0x9b,0x99,0xac,0xc7,
0xc2,0xaf,0x88,0xd9,0x2b,0xfd,0x1f,0xb4,0x6e,0x37,0x22,0xe7,0x18,0x71,0xc5,0x1c,
0x17,0x29,0x45,0x11,0xd8,0xbb,0xef,0x11,0x83,0x4a,0x4f,0x20,0xca,0x93,0x1c,0x2e,
0x02,0x8a,0x9f,0xaa,0xfe,0x65,0x5e,0x17,0x27,0x28,0xfe,0x27,0xe7,0x13,0x2c,0x2e,
0xe5,0xcc,0xd7,0x6e,0xf8,0x03,0x70,0x75,0xda,0x21,0xf2,0xbb,0x3f,0xf6,0xd7,0x5b,
0x50,0x2f,0x57,0xff,0x9a,0x36,0x9c,0xb2,0xfa,0x74,0xcc,0x8e,0x3b,0x6b,0x51,0xd4,
0xe1,0x02,0x45,0xbc,0x00,0xb5,0xc6,0x94,0x21,0xd0,0x7d,0xc0,0xe0,0x1a,0xf0,0x28,
0xc7,0x83,0x70,0xd8,0x3a,0x1a,0x00,0x5e,0x93,0x0e,0x2c,0xd1,0x42,0xad,0xe8,0x4d,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,
0x43,0xc5,0x03,0x3b,0x13,0x4b,0x96,0x8c,0x1c,0x3b,0x03,0xdb,0xc1,0xaf,0x56,0x5a,
0xa1,0xea,0x9a,0x83,0x89,0x18,0x51,0xf4,0x35,0x2b,0x96,0xf6,0xaf,0x2b,0x1e,0x92,
0x29,0xa4,0x9e,0xcb,0xaa,0xd4,0xc0,0x2a,0x93,0x6b,0xa0,0xff,0x1e,0xf8,0x9c,0xda,
0x06,0x66,0x56,0x2f,0x70,0x7b,0x52,0x6d,0x21,0x17,0x3f,0x4f,0xfc,0xa3,0xfa,0x1a,
0xa3,0xb4,0xfe,0xf7,0xb1,0xdd,0xd6,0xb7,0x66,0x82,0xa8,0xad,0x25,0x81,0xbb,0x8e,
0xde,0x2a,0x36,0x3d,0x3e,0x32,0x56,0x6a,0x57,0x98,0x44,0xac,0xfa,0x03,0x8b,0x5f,
0x9e,0x6e,0x78,0x97,0xcc,0x45,0x12,0x39,0xa5,0x35,0xc9,0x2c,0x71,0xa0,0xaf,0xca,
0x54,0xa2,0x61,0xe6,0x60,0x20,0x7a,0xbb,0x5f,0x8e,0x0a,0x91,0x36,0x95,0xb0,0xbf,
0xec,0xc7,0x48,0x17,0xc0,0x2f,0x8a,0xaf,0xb4,0xa2,0xb6,0x01,0x28,0xdf,0x40,0xe3,
0x81,0x47,0x2b,0xea,0xe9,0xcf,0x50,0xed,0x6c,0x39,0xb5,0xe6,0x76,0x14,0x85,0x18,
0xb0,0x3f,0x0d,0x3c,0x6f,0x31,0xe1,0x2b,0xbd,0xc2,0x7e,0x83,0x98,0x5d,0x00,0x97,
0xdb,0x0a,0x85,0x54,0x09,0x12,0x1b,0xab,0xe4,0x1c,0x86,0x7e,0xdf,0xd0,0xd6,0xd9,
0x9d,0xbf,0x57,0xe0,0x16,0xf9,0xdf,0x9c,0x65,0x7a,0xb3,0x1d,0x9f,0x06,0xd8,0xcd,
0xaf,0xb6,0x61,0x45,0xef,0x85,0x8d,0x9d,0xe9,0xb2,0x47,0x05,0x38,0xea,0xbc,0x97,
0xb7,0xb9,0x5a,0x2c,0xd6,0xeb,0x7e,0x18,0x32,0x8f,0xc2,0x83,0x32,0x1a,0xf4,0x70,
0x56,0x62,0x74,0x2b,0x8d,0xe1,0x92,0x84,0x3e,0xc2,0xcb,0x91,0xe0,0x4b,0x4c,0xfb
};
const unsigned long p[] = {
0xf33decd1,0x08bbe7af,0x46ff095b,0xfeb43c64,0xdaab4b83,0x889a70e3,0xb2715c6a,0xaf15ea6e,
0xc3c41f41,0x8f48dfa7,0x87d1258c,0x87f97300,0x3c45a5e5,0x19aaa69c,0x691c7b75,0x3fe15b57,
0x368dd38c,0x3f9627d4,0x849903b6,0x3f6b17d0,0x5cd4c659,0x8c8db86b,0x9d5aeb56,0xe2ae7e8e,
0x770fe3fb,0x043d267a,0x62ce586a,0xe5c0a3f8,0x7f24a848,0xec4e4731,0x82261cd0,0xb273516c,
};
const unsigned long q[] = {
0xfeb172bd,0x737e1a01,0x941e1ae9,0x01574053,0x5733fc73,0xb6f8baea,0x1aa95024,0xa5f352d3,
0xc5562c02,0x75e03523,0xdf7bf661,0xe3b2cee2,0xb165f744,0xb2004664,0xca403f1d,0xbc67f0c8,
0xf5248566,0x92be91c2,0xa31f57e8,0x1b06b7e7,0x772194af,0x1816947f,0xe299a731,0x9a6e8029,
0x321f018a,0x7159ec20,0x26dea1a1,0xc9168942,0x7b85a571,0xeac70034,0x8dc5e6c4,0xc530dd54,
};
const unsigned long dp[] = {
0x0af1ec81,0x25c31813,0x069afac6,0xeb6190f4,0x50b367c9,0x486534d0,0x9e3881a4,0xf83a5222,
0x676f312a,0x94229ba9,0x7a88510f,0x05e0ed2a,0xb7631e68,0xff6b9727,0x901b989f,0xa2559aa6,
0xe819d6f9,0xdcbdf72e,0x806edc86,0x21b292a2,0x738da63b,0xa4880104,0x7d71b8c4,0x4fa0c881,
0x8e35de73,0x35a0e42a,0x81d0c5ec,0xbdf371a2,0xdbbd1bfc,0x7f5ede51,0xf270401e,0x3eab9124,
};
const unsigned long dq[] = {
0xc27322c9,0xf9b36ebd,0x65ab97fb,0xb488d93f,0x13766510,0xb779b2af,0x54886f92,0xf901df44,
0xeebc49b9,0xceb2a2ba,0xfa97bdc4,0xeb7a91d0,0xc22af231,0xce78d187,0xb440f386,0xd3c81d1f,
0x164a5d67,0xc5be6d72,0x82c90efe,0x723c1766,0x1a70b448,0x2dd7ae8f,0x81b83008,0xc585ea4a,
0x4bda0bc1,0x77f99388,0x6960c7ad,0x9acac9dc,0xb727fd1b,0x32c0205c,0xf5a1578b,0x64d9bef8,
};

const unsigned long qi[] = {
0x485190b0,0x9ee6cb31,0xf51c992b,0x1651f1e4,0x512ed64d,0xe44c8ffb,0xdaf05efd,0xe714b3f8,
0xac835f2a,0x4ccb5055,0x5328abe6,0xca80e876,0x147b0a5a,0x61954bff,0x9500c590,0x9289c19b,
0x59db813d,0x4e38984a,0x96b7d6f7,0xddcf9915,0x88ac082f,0xed821ea3,0xe0a452cf,0x17c809a8,
0x40088478,0x2c1374ba,0xb2a33f88,0x6ec68d5a,0x7371555f,0xc934ed35,0xc71683fd,0xb06e673b,
};
const unsigned long pi[] = {
0x493E8FFE,0x9565670D,0x8EBC2D44,0x9B7CC21A,0xC79A3423,0xBCBD57A7,0x952B690A,0xE882E34B,
0x4323BD0C,0x8D85D13A,0xD9B0DF35,0x9E04B1A3,0x411C7E21,0xF0BD398E,0xBA441870,0x3BEA3AD7,
0xB917C695,0x8370B7AE,0x7FD90438,0x2FDEAE7F,0x22E854BC,0xCE850126,0x9C0EEF5D,0xD359C448,
0x3B275CE2,0x578E4F1C,0xDA847C32,0x0D98E5EF,0x9182A3A3,0x7478A591,0x16D7D1AD,0x023B332C
};
const unsigned long rqi[] = {
0xAAD6CD78,0x8C149ADB,0x5F7BE4B4,0xD00BF76B,0x38A590BB,0x6EC5FAFD,0x18A001BD,0x19743FCD,
0xCD36AC53,0xA19D987C,0x52C7F90F,0x543E1AF0,0x0A03A3CC,0xC87E3FFB,0xE621B10D,0x8555BC9A,
0x07A39BC6,0x957503AA,0xC3780762,0x18798E5F,0x92B8D264,0xDBEE0269,0x5529A703,0xB5C159AD,
0x6CF2FBB4,0x62D73C3C,0xA9EC7B15,0x347B876E,0xC727C1A8,0xC67E2DF0,0xC872EF75,0xA9E2B71E
};
const unsigned long rpi[] = {
0xD3709051,0xA6ED0CEB,0xFC57DD66,0xC0A3981C,0xB4EC0C63,0x6A933485,0x9D916593,0x0B2ECAD1,
0xB90A0E2D,0xD31F24AE,0x1925920B,0x2A1A8F3F,0xD3415103,0x13AA34B5,0xF52E9942,0x0D78AC59,
0xBB76CDB1,0x75CD3117,0x1F925DF0,0x1B5310C2,0x85C6942F,0xCBFC8732,0x70BF4D50,0xF08FFF83,
0x2EB45C23,0x8956798D,0x7FE69289,0x18153671,0x1FF48EA2,0xFED12275,0xA8D3DE23,0x6CDEC23C
};
const unsigned long nqi[] = {
0x0987676B,0x64BA5739,0xE7DA34BC,0xE1849551,0x035CD0CF,0x8BF9E0A4,0x31997D45,0x5D2FCCC7,
0xCC473CF2,0x666B8D00,0xCBB963EC,0x899A7155,0x4CF4C1A2,0x69341FD3,0x0A117751,0xE281E466,
0xBC4E5F72,0xC158AF2D,0x22021A85,0x9CAEED68,0xF7CCD56D,0xA11DE659,0xFBAC6783,0xA5BA2AA7,
0xC057DE4A,0x0B17F826,0xFF38E8FA,0x2E270E87,0x32A3C527,0x32B2B5F3,0x5F3F7D7E,0xDC8D25A6
};
const unsigned long npi[] = {
0x413A13CF,0x91904D44,0x90C62F5A,0xF6FDFEB3,0x02E7757D,0x98C70593,0x39F2486C,0x95F9422C,
0x56F0CA84,0xB5418770,0x290E7F91,0x44BD3E4A,0x52402B4A,0xB027E86E,0x5BF720C1,0x129C9AD0,
0x25F672BD,0x32A28011,0xAEBF6AC6,0x5C19BC6C,0xFE2C71CF,0x8E0651F8,0x1D918E1D,0xAC97364E,
0x527A6BA9,0xA958D6B3,0x8716D201,0x112585A4,0xF2186207,0x7CB4FD2C,0x9BA54E5A,0x9C2E9AC9
};

#else           //yunlong

const unsigned char post[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x1b,0x63,0x8b,
0x86,0xdf,0xe6,0x6d,0x67,0x4a,0x94,0xde,0xe2,0xbd,0x1a,0xf0,0xc2,0xa0,0x8d,0x0a,
0xad,0x95,0xf2,0x3c,0x13,0x0e,0xd1,0x83,0xfd,0x70,0x4b,0x71,0x3c,0xa9,0xb5,0x42,
0x62,0x66,0x47,0x92,0x30,0xc0,0xb1,0x6b,0x27,0x5a,0x51,0x99,0x40,0x95,0x6a,0xa6,
0x35,0x42,0xdf,0xff,0x95,0xe8,0x17,0x27,0x4e,0x8e,0x1c,0xf0,0x85,0x19,0x0c,0xe7,
0x95,0xec,0xa3,0x06,0x81,0x83,0x71,0x44,0x97,0x34,0xa3,0x09,0xcc,0xe8,0xc0,0xb8,
0x7f,0x72,0x93,0x05,0x57,0x7b,0x72,0x6a,0xcd,0xf2,0x64,0x8f,0x20,0xde,0x11,0x42,
0xa5,0x80,0x78,0x6e,0xed,0x1c,0x8e,0xba,0xf5,0x30,0x4a,0x86,0x07,0xd4,0x78,0xb8,
0x17,0xcf,0x3c,0x5e,0xdb,0x13,0xa6,0x10,0x64,0x58,0x82,0x2f,0x2b,0x74,0x36,0xe8,
0x29,0xae,0x03,0xca,0xfb,0x3f,0x99,0x90,0x99,0x16,0x38,0xe4,0x06,0x14,0xe6,0xb2,
0xca,0x2d,0xe8,0x03,0x03,0x30,0x1e,0xf0,0x67,0xa0,0x40,0x62,0xba,0xb4,0x3a,0xc5,
0x06,0x70,0x15,0x7f,0xfa,0xed,0xf1,0x14,0xe0,0x6a,0xa8,0x71,0xb7,0x9d,0xeb,0x10,
0x56,0x3c,0xb1,0x34,0xda,0x13,0xe6,0xf8,0x7d,0x0e,0xf4,0x4b,0x22,0xc8,0x2e,0xb4,
0x22,0x70,0xfe,0xfe,0xbe,0x8c,0xfb,0x2b,0x25,0xe8,0xfe,0x3d,0x40,0x43,0x84,0x77,
0x93,0x3f,0x6b,0x8f,0xfe,0xc6,0x83,0xe2,0x18,0x42,0x65,0xcd,0xa3,0xc2,0x94,0x33,
0x4a,0xbe,0x4d,0x6f,0x12,0xe7,0xb0,0x94,0x2c,0x8c,0x09,0xbd,0xe4,0x4e,0x61,0xff,
0x3b,0x7b,0x31,0x9d,0xaf,0x5b,0xd4,0xc3,0x24,0xb6,0xcc,0xa0,0xfc,0x07,0x02,0x93,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,
0x56,0x03,0x17,0xe1,0xeb,0xd6,0xb4,0x3b,0x85,0x11,0xa6,0xda,0xcd,0x2c,0x16,0xd6,
0x91,0xdd,0x18,0xd2,0x2e,0xb2,0xd9,0x2e,0x83,0x7f,0xbb,0x68,0x4f,0x4a,0xb9,0x60,
0xa3,0x49,0xc7,0xa6,0x9f,0xc9,0x04,0xbb,0x29,0xc1,0x6d,0x9b,0x14,0x52,0x32,0xb1,
0x9b,0xc6,0x60,0xe8,0x5a,0x01,0xcc,0x76,0x49,0x1f,0x78,0xd2,0xaa,0x09,0x5d,0xa2,
0x0a,0x51,0x12,0x2d,0x19,0xc7,0x60,0x30,0xf2,0xa6,0xb1,0xa5,0xd6,0x3d,0xd3,0xbd,
0x7d,0x88,0x9d,0xfe,0xbc,0x35,0xde,0x04,0x66,0x30,0x4d,0x0c,0xb5,0xc8,0xd0,0x87,
0x4d,0xa2,0xbc,0x72,0x80,0xdd,0xfe,0xac,0x85,0xd8,0x51,0xac,0x45,0xee,0xf1,0x2e,
0x2d,0x61,0xa0,0xb4,0xbd,0x8f,0x8d,0x8b,0xf4,0xcc,0x2d,0x04,0x3c,0x34,0xe3,0x1b,
0xd5,0xa3,0xbe,0x17,0xb5,0xf4,0xde,0x70,0xdd,0x5f,0x0d,0xd6,0x0a,0x4b,0x90,0xd1,
0x5b,0xaf,0xa5,0xc3,0x5a,0xb8,0xde,0x0a,0xff,0xf6,0x5c,0x4e,0xa3,0xd7,0xcf,0x0a,
0x55,0x2f,0x90,0xe8,0x05,0x33,0xb1,0x71,0x40,0xc4,0x32,0xae,0xc1,0xce,0x15,0xa0,
0x38,0xe5,0x2b,0x3f,0x18,0x31,0x56,0x0e,0xe4,0x97,0xda,0xae,0x0a,0x31,0x21,0x1e,
0xbb,0x77,0xdc,0xd5,0x42,0x54,0x44,0x68,0xea,0x15,0xb6,0xe9,0xc4,0x4d,0x67,0xe6,
0x28,0x26,0x25,0x13,0xbf,0x90,0xdc,0x89,0x6e,0xe3,0xaa,0x7a,0xfc,0x2e,0x2c,0x41,
0x51,0x5c,0x4c,0x0c,0xbc,0xa9,0xf9,0x5c,0x78,0x5b,0xb1,0x22,0xb4,0x40,0x07,0x82,
0x20,0x3c,0x07,0xac,0xa0,0x46,0x0e,0x6b,0x47,0xbf,0xf6,0x7c,0x1c,0x9c,0xc3,0xd6,
};
const unsigned long p[] = {
0xb17c2797,0xfac130de,0xd64ab956,0x7051d820,0x65015447,0x84ed2ee3,0x5238cf6b,0x9e26a67c,
0xe5f59eef,0x5001516e,0x3a4a38ac,0x4d5f1888,0x17bed5b8,0x81dc8fc0,0xc2668097,0x2a79a14e,
0xe4e627a9,0x2c395c9d,0xe8f1cc79,0x2cb2d140,0x2677fcfc,0x7ccae9fe,0xa1e39a62,0xfaddb4a1,
0x0de40eef,0xd133942e,0xc98911d0,0x4a82c488,0xe87aea58,0x9244697c,0xd788fbb9,0xaa4f82d1,
};
const unsigned long q[] = {
0xc1dc3c65,0x140a7e87,0xe9078ee5,0x6997998e,0xed761594,0x72e8d0a0,0xda150468,0xbe25d51a,
0xef1836b7,0x3c9ce1a6,0x6cf01daf,0x71abadb3,0xcdc766f0,0x705b14c0,0x649efe8f,0xc584e5ba,
0x64289053,0xa7366da9,0x34e98bbb,0x54ffda04,0x7cef6051,0x482cb57b,0x978a0e18,0xa17c3730,
0x39c17187,0x6f6687d8,0x08cb8e55,0x1fa0b272,0x1febb403,0xd6e47908,0xf21c5e6d,0xcabc2249,
};
const unsigned long dp[] = {
0xe5423b03,0x0cc4946e,0x9e572d2c,0xfb8952d1,0x23b31901,0xb64c31a7,0x8f94c7ef,0xf5a4556a,
0x39115406,0x1df6ff5c,0xb6eeaf4c,0xaf8add7d,0x162d7101,0x7f200443,0x70015ab6,0x2d306745,
0x7566a0df,0x646c540f,0x6c5ac64f,0xea421eaf,0x66cd6932,0x5df4d797,0x6ad16ab4,0x8e89e730,
0x91981795,0xe690da0f,0x6b66b8f8,0x6e68c043,0x4f06eba1,0x93501327,0x20876ae0,0x16e0553f,
};
const unsigned long dq[] = {
0x79428995,0x7bfec0b0,0xd13e8a46,0x4a125f8e,0x9d002c73,0x6eaf59f5,0x8361434b,0x6913024e,
0x2831bfa4,0xa1637f8e,0xb4e64ea4,0xaca16d93,0x50986eb2,0xb898f1bc,0xa6367616,0xf4ce76c0,
0xc8510ba5,0x41609673,0x9c199ab9,0x45809a68,0x4c5e31fa,0xb1ec1376,0xf6d4b0c4,0x9ed790c8,
0xc976438a,0x6a8e397d,0x0136fb81,0x28a096c8,0x9b2ae321,0x16ee5199,0x737ed9e9,0x5b35cb43,
};
const unsigned long qi[] = {
0x4efd4554,0x8b76f13d,0x7caff324,0x1d539cbc,0xdc924ea2,0x9bbf4ebb,0x02b21220,0x1a5b926c,
0x50f8b751,0xa89dd49e,0x9666c968,0x0468968c,0x5bdb8b85,0x08941778,0x7397c2d0,0xba76ff1f,
0x31515607,0xad34974a,0x377aa92a,0x0d52d03c,0x09d06e9a,0x6528c816,0x04fa39d5,0xa9191453,
0x37254e5a,0xa26787ae,0xcd3feeee,0xc1c39eaa,0x5dc3734e,0x2c836d05,0xef3ec26c,0xa78f8dff,
};
const unsigned long pi[] = {
0x81a35910,0x0d8bf05a,0x032a63c9,0x5c910305,0xf782f217,0xe8b84a30,0x9a26eaf3,0xc3e5486f,
0x39fe8ded,0xea9aaac5,0x01db053e,0xf5a44137,0x1c87be95,0x28508d8d,0xdfa952b5,0x60a9bb9b,
0xbb978a1c,0x13f7eff3,0x5ad2960c,0xec75945a,0xae090fc5,0xc26c08a0,0x3ec59dc6,0x8ff357c6,
0xc60ef1f8,0x50db723f,0x25dec870,0x9e65bb2b,0x4aff7006,0xe59d63c5,0x32d3e833,0x0345fa59,
};
const unsigned long rqi[] = {
0x53bd1488,0x75bcc36c,0x742495fa,0xb26c890d,0xb137a617,0x7b021744,0x7eb306b5,0x2901d37f,
0x6aa720ff,0xeacd45b5,0xd4aba82a,0xc44f5686,0x38c51dee,0x7b9b605d,0x74888956,0xc738e754,
0xea33c641,0x1eb3b868,0xcbf3dabb,0xa06f5fea,0x513fa246,0x0c8c4df5,0x2fb0f787,0x4738c25d,
0x50fd0d58,0x555b02c3,0xe2ced594,0x9f3b168b,0xc950dbb2,0xbce5ed8b,0x887e3ac3,0x28f0fa2d,
};
const unsigned long rpi[] = {
0xc977dcb6,0x80d0f429,0xf6390fe2,0x8831f64b,0x2fbe3c33,0x1e1de64f,0x577edc98,0x7cf55617,
0x4f13ab4d,0xd14452ca,0x82b97e7f,0xcbee36bc,0x01a03260,0xedc6db83,0xe4b600a7,0x5caf9ab7,
0x1ab6f1a9,0x2343e3d0,0xa44ef623,0x0c649004,0x7cc41417,0x453f09fc,0x7bdce826,0x8cfc8260,
0x80d098ba,0x8cb99830,0xc5266cba,0x15dcf41d,0xdb7ce4ba,0xa143e272,0x36ccd6c7,0x61785103,
};
const unsigned long nqi[] = {
0x9031ea93,0xe4cfed58,0x47ad6277,0x5ed4a70c,0x26863b5b,0x32100c75,0x1c1f57a3,0x356f913f,
0xe11c8828,0x7d286696,0x67cbb36f,0x56ae07bd,0xf59c50ec,0x7bb287df,0x5a72f69e,0x748b66be,
0xb1de7408,0xc5935df5,0x8f847e4a,0xe43982c5,0x44353203,0x0c78ba2a,0xdeee929b,0x06606072,
0xb35ce0a8,0xff6868c3,0x350fb34d,0xdabf9609,0x9835e587,0xf32cc124,0x3f9cfd18,0x33b2ac68,
};
const unsigned long npi[] = {
0x18e737d9,0x677d7e04,0x70de041d,0xf9f51e17,0x07582141,0x9b0dc252,0xe44f4365,0xbf2b2681,
0xc9b62bfd,0xf5cd4032,0xbddb0f11,0x497f9de9,0x5adf3278,0xf8a6840d,0x36eecb0f,0x49183a22,
0xb3d895ee,0x5da61286,0x67a28452,0xf9f42659,0x7c5cd6bc,0x74097007,0xaec17974,0xebd08810,
0x926f96c4,0x91609137,0x6252ab29,0x2cb58169,0x94556039,0xe97a1f89,0x3c4814d7,0x9282ba6e,
};

#endif

unsigned long m[words];
const unsigned long* n;
const unsigned long* ri;
const unsigned long* ni;
const unsigned long* e;
unsigned long* res;
unsigned long temp[words];
#if dbits > 1
unsigned long muls[dcnt-2][hwords];
#endif


/*****************************************************************************************************
**  Function
******************************************************************************************************/


#define copyh(a, b) \
{       \
    for (int i = 0; i < hwords; i++) (a)[i] = (b)[i];       \
}

#define copyw(a, b) \
{       \
    for (int i = 0; i < words; i++) (a)[i] = (b)[i];       \
}

#define zeroa(a, b) \
{ \
    for (int i = 0; i < (b); i++) (a)[i] = 0; \
}

#define addone(ares, aidx, adata)       \
{                                       \
    adata += ares[aidx];                \
    ares[aidx] = adata;                 \
    adata >>= 0x20;                     \
}

#define addat(ares, aidx, adata)                                \
{                                                               \
    unsigned long long ldata = adata;                           \
    addone(ares, aidx+0x00, ldata);                             \
    addone(ares, aidx+0x01, ldata);                             \
    if (ldata) addone(ares, aidx+0x02, ldata);                  \
    if (ldata) addone(ares, aidx+0x03, ldata);                  \
    {                                                           \
        int i = 4;                                              \
        {                                                       \
            while (ldata) addone(ares, aidx+i, ldata);          \
            i++;                                                \
        }                                                       \
    }                                                           \
}

int cmpbuff(const unsigned long* a1, const unsigned long* a2, int awords)
{
    int lpos = awords;
    while (--lpos >= 0)
    {
        unsigned long l1 = a1[lpos];
        unsigned long l2 = a2[lpos];
        if (l1 < l2) return -1;
        if (l1 > l2) return 1;
    }
    return 0;
}

void shlbuff(unsigned long* abuff, int awords, int acnt)
{
    if (acnt <= 0) return;
    unsigned long c = 0;
    unsigned long nextc;
    for (int i = 0; i < awords; i++)
    {
        nextc = (abuff[i] >> (32-acnt));
        abuff[i] = (abuff[i] << acnt) | c;
        c = nextc;
    }
}

void shrbuff(unsigned long* abuff, int awords, int acnt)
{
    if (acnt <= 0) return;
    unsigned long c = 0;
    unsigned long nextc;
    for (int i = awords-1; i >= 0; i--)
    {
        nextc = (abuff[i] << (32-acnt));
        abuff[i] = (abuff[i] >> acnt) | c;
        c = nextc;
    }
}

int subbuff(unsigned long* abuff, const unsigned long* asub)
{
    long long lres = 0;
    int i = 0;
    while ((i < hwords) && (asub[i] == 0)) i++;
    for (; i < hwords; i++)
    {
        lres += abuff[i];
        lres -= asub[i];
        abuff[i] = lres;
        lres >>= 0x20;
    }
    return lres;
}

void mulbuff(const unsigned long* a1, const unsigned long* a2, unsigned long* ares)
{
    zeroa(ares, hwords+hwords);
    for (int i1 = 0; i1 < hwords; i1++)
        for (int i2 = 0; i2 < hwords; i2++)
        {
            addat(ares, i1+i2, mul64(a1[i1], a2[i2]));
        }
}

void mulbuff32(unsigned long a1, const unsigned long* a2, unsigned long* ares)
{
    zeroa(ares, 1+hwords);
    for (int i2 = 0; i2 < hwords; i2++)
    {
        addat(ares, i2, mul64(a1, a2[i2]));
    }
}

unsigned long addbuff(unsigned long* abuff, const unsigned long* aadd)
{
    int lpos = 0;
    unsigned long long ladd = 0;
    while (lpos < hwords)
    {
        ladd += aadd[lpos];
        ladd += abuff[lpos];
        abuff[lpos++] = ladd;
        ladd >>= 0x20;
    }
    return ladd;
}

unsigned long addbuff2(unsigned long* abuff, const unsigned long* aadd)
{
    int lpos = 0;
    unsigned long long ladd = 0;
    while (lpos < words)
    {
        if (lpos < hwords)
        {
            ladd += aadd[lpos];
        } else if (ladd == 0) return 0;
        ladd += abuff[lpos];
        abuff[lpos++] = ladd;
        ladd >>= 0x20;
    }
    return ladd;
}

void mul(const unsigned long* a2)
{
    unsigned long lt[hwords*2];
    unsigned long lm[hwords+1];
    mulbuff(temp, a2, lt);
    for (int i = 0; i < hwords; i++)
    {
        unsigned long lw = lt[i] * ni[0];
        mulbuff32(lw, n, lm);
        temp[i] = lm[hwords] + addbuff(&(lt[i]), lm);
    }
    if ((addbuff(temp, &(lt[hwords]))) || (cmpbuff(temp, n, hwords) > 0))
    {
        subbuff(temp, n);
    }
}

void modbuff(unsigned long* abuff)
{
    unsigned long long lwork;
    unsigned long lbuff[hwords+1];
    unsigned long ldiv[hwords];
    copyh(ldiv, n);
    int lshift = 0;
    {
        unsigned long h = ldiv[hwords-1];
        while ((h & 0x80000000) == 0)
        {
            h <<= 1;
            lshift++;
        }
    }
    shlbuff(ldiv, hwords, lshift);
    for (int i = 0; i <= lshift; i++)
    {
        if (cmpbuff(&(abuff[words-hwords]), ldiv, hwords) >= 0)
        {
            subbuff(&(abuff[words-hwords]), ldiv);
        }
        if (i < lshift)
            shrbuff(ldiv, hwords, 1);
    }
    shlbuff(ldiv, hwords, lshift);
    shlbuff(abuff, words, lshift);
    for (int i = 1; i < (words - hwords + 1); i++)
    {
        lwork = abuff[words-i];
        lwork = (lwork << 0x20) | abuff[words-1-i];
        lwork /= ldiv[hwords-1];
        if (lwork >> 0x20) lwork = 0xffffffff;
        if (lwork != 0)
        {
            mulbuff32(lwork, ldiv, lbuff);
            while (cmpbuff(lbuff, &(abuff[words-hwords-i]), hwords+1) >= 0)
            {
                lbuff[hwords] += subbuff(lbuff, ldiv);
            }
            subbuff(&(abuff[words-hwords-i]), lbuff);
        }
/*
        {
            unsigned long d = subbuff(&(abuff[words-hwords-i]), lbuff);
            if (i > 0)
            {
                abuff[words-i] -= lbuff[hwords];
                abuff[words-i] += d;
            }
        }
        */
    }
    shrbuff(abuff, hwords, lshift);
}

void makehalf()
{
    int lbit = (hwords*32)-1;
    while ((getbit(e, lbit) == 0) && (lbit >= 0)) lbit--;
    if (lbit < 0)
    {
        zeroa(res, hwords);
        res[0] = 1;
        return;
    }
    copyw(temp, m);
    modbuff(temp);
    copyh(&(temp[hwords]), temp);
    zeroa(temp, hwords);
    modbuff(temp);
    copyh(&(temp[hwords]), temp);
#if dbits > 1
    for (int n = 2; n < dcnt; n++)
    {
        mul(&(temp[hwords]));
        copyh(muls[n-2], temp);
    }
    copyh(temp, &(temp[hwords]));
#endif
    int c = 0;
    int d = 0;
    while (--lbit >= 0)
    {
        mul(temp);
        d <<= 1;
        d |= getbit(e, lbit);
        c++;
        if ((c == dbits) || (lbit == 0))
        {
            switch (d)
            {
            case 0:
                break;
            case 1:
                mul(&(temp[hwords]));
                break;
#if dbits > 1
            default:
                mul(muls[d-2]);
#endif
            }
            d = 0;
            c = 0;
        }
    }
    copyh(res, temp);
    mulbuff(res, ri, temp);
    modbuff(temp);

    copyh(res, temp);
}

void bin2buff(unsigned long* abuff, const void* abin)
{
    for (int i = 0; i < words; i++)
    {
        abuff[words-1-i] = (
            ((((unsigned char*)abin)[i*4+3]) << 0x00) |
            ((((unsigned char*)abin)[i*4+2]) << 0x08) |
            ((((unsigned char*)abin)[i*4+1]) << 0x10) |
            ((((unsigned char*)abin)[i*4+0]) << 0x18)
                );
    }
}

void buff2bin(void* abin, const unsigned long* abuff)
{
    for (int i = 0; i < words; i++)
    {
        unsigned long ldata = abuff[words-1-i];
        ((unsigned char*)abin)[i*4+0] = ldata >> 0x18;
        ((unsigned char*)abin)[i*4+1] = ldata >> 0x10;
        ((unsigned char*)abin)[i*4+2] = ldata >> 0x08;
        ((unsigned char*)abin)[i*4+3] = ldata >> 0x00;
    }
}

void p2_doit(const void* ainput, void* aoutput)
{
    unsigned long lmq[hwords];
    unsigned long lmp[hwords];

    bin2buff(m, ainput);
    n = q;
    e = dq;
    ni = nqi;
    ri = rqi;
    res = lmq;
    makehalf();

    bin2buff(m, ainput);
    n = p;
    e = dp;
    ni = npi;
    ri = rpi;
    res = lmp;
    makehalf();

    if (cmpbuff(lmp, lmq, hwords) > 0)
    {
        n = p;
        subbuff(lmp, lmq);
        mulbuff(lmp, qi, m);
        modbuff(m);
        copyh(lmp, m);
        mulbuff(lmp, q, m);
        addbuff2(m, lmq);
    } else
    {
        n = q;
        subbuff(lmq, lmp);
        mulbuff(lmq, pi, m);
        modbuff(m);
        copyh(lmq, m);
        mulbuff(lmq, p, m);
        addbuff2(m, lmp);
    }
    buff2bin(aoutput, m);
    for (int i = 0; i < 0x310; i++)
        ((unsigned char*)aoutput)[0x100+i] = post[i];
}



#if 0
extern unsigned char ps_encrypt_buf[1040];
const unsigned char test1[] = {
0x49,0x92,0xfe,0x49,0x6f,0xf0,0xa9,0xc0,0x4b,0x44,0xe2,0xb7,0xa0,0xe2,0xe6,0x8e,
0x04,0x20,0xbb,0x9e,0x99,0xd9,0x99,0x82,0x7e,0x08,0xd6,0x3f,0xe2,0x51,0x08,0xa4,
0x39,0x4e,0x44,0xdd,0x63,0x42,0xff,0xf4,0x7e,0xae,0x8c,0x3f,0x7c,0xfa,0xd6,0x43,
0x0c,0xa2,0xd5,0xaa,0x93,0x7e,0xb4,0x26,0xb8,0x29,0x58,0x48,0x89,0x2f,0xf3,0xc1,
0xa3,0xed,0x08,0x2d,0xec,0xcd,0xbf,0xdc,0xa0,0x95,0x45,0x52,0x13,0x14,0xae,0x5c,
0x61,0x01,0x10,0x67,0xe8,0xbc,0x76,0xfe,0xa6,0x32,0x69,0x0e,0x84,0x18,0xd3,0x0b,
0x37,0x2d,0xee,0xef,0xb5,0xbc,0x20,0xab,0xa6,0x9d,0x33,0x42,0x76,0x6c,0x39,0xa5,
0xe4,0xaf,0x46,0xff,0xe7,0xb4,0x85,0xbf,0x61,0xc2,0x73,0x1a,0x3b,0xf4,0x07,0x41,
0x3f,0x24,0xcd,0x83,0x8d,0xe0,0x01,0x74,0x22,0xeb,0x15,0x6d,0xbd,0x0d,0x29,0x70,
0x62,0xbe,0x04,0x29,0x15,0x8d,0x80,0x6f,0xb0,0xca,0x00,0x21,0xb7,0xb7,0x2e,0xdc,
0x71,0x35,0xbd,0x64,0x72,0xfa,0xdc,0x60,0x1e,0xe9,0x95,0x12,0x40,0x2e,0x6e,0x5a,
0xb2,0x65,0x56,0x1f,0xa9,0x56,0x16,0x0d,0x6c,0xf4,0xd2,0x69,0xf5,0x1c,0x68,0xf7,
0x13,0xff,0x84,0x55,0x42,0x51,0x32,0x3a,0x6a,0x48,0x79,0xaa,0x58,0xf1,0x9f,0x2d,
0xdd,0x5f,0x1b,0xd7,0xa0,0x02,0xd2,0x3d,0x1e,0x3d,0x47,0x29,0x21,0x4b,0xd6,0xc2,
0x39,0xa8,0x8a,0x08,0x0a,0xa5,0x26,0x1a,0xe3,0x25,0xe7,0xfa,0x8e,0x59,0xb8,0x91,
0x5b,0x84,0x75,0xa0,0x71,0x85,0xf6,0x7c,0xbe,0x73,0x02,0x35,0x00,0x40,0xe9,0xbc
};

const unsigned char test1_result[] = {
0x1a,0x4d,0xd9,0x0a,0x9f,0x31,0x97,0x1e,0xd2,0x55,0xf6,0xb0,0x46,0xb6,0x93,0xd7,
0x56,0x09,0xc1,0x82,0xfa,0x72,0x23,0xa2,0xf3,0xa2,0x74,0x99,0xcd,0x89,0xfe,0x9a,
0xe1,0xaa,0xc5,0xab,0x8f,0x60,0x7d,0x18,0xb0,0x41,0x48,0xbd,0x11,0x25,0x28,0x5f,
0x7b,0xcf,0x16,0xc8,0x0e,0x8e,0x75,0x2c,0x68,0xa4,0x9a,0x36,0x98,0xa4,0xfc,0x7c,
0xfb,0x81,0x90,0x90,0x3e,0xb0,0x6d,0x43,0xee,0xd3,0x52,0x97,0x6f,0x88,0x37,0x6f,
0x0a,0x76,0x9e,0x2c,0xdd,0x28,0xae,0x53,0xce,0xfd,0xe0,0x34,0x67,0x7e,0x56,0xd3,
0x95,0x8e,0x12,0xd3,0x84,0xf2,0x83,0x71,0x27,0xcd,0x5d,0x23,0xcb,0xc7,0x53,0x3e,
0x38,0x0f,0x59,0x95,0xb9,0x55,0xa3,0xce,0x73,0xb5,0x94,0xa5,0x69,0x67,0x0d,0x90,
0xb5,0xc8,0xbd,0x3c,0xa5,0x71,0xc7,0x7f,0x4e,0xb3,0x93,0x8c,0x44,0xa1,0xbc,0xc5,
0x3d,0x0e,0x8f,0x12,0x27,0x43,0x55,0xc7,0x94,0x72,0xf6,0x04,0x19,0xc1,0xcd,0x2f,
0x52,0x2e,0x16,0xcf,0x4f,0xd4,0xcf,0xe0,0x32,0xd0,0x28,0xbd,0x38,0xb4,0xc6,0xc6,
0x3f,0x11,0x7c,0xca,0x69,0x24,0x31,0x17,0xaa,0x37,0x9e,0xf0,0x0c,0xd3,0x81,0xdf,
0x5f,0x5f,0xc2,0xc1,0x5c,0xfd,0x5f,0x70,0x56,0x6f,0xd8,0xd7,0xcf,0xf5,0xce,0xe2,
0xb0,0x16,0xce,0xbd,0xfc,0xd6,0x65,0x7f,0x77,0x66,0xf0,0x90,0x88,0x48,0x47,0x42,
0xdd,0xa1,0x6b,0x4e,0xfa,0xb7,0x22,0xdd,0x35,0x41,0x91,0xa7,0xea,0x90,0xed,0x00,
0x06,0x94,0x34,0x50,0xd5,0x63,0x55,0xe0,0x27,0x19,0xf0,0xc8,0xf6,0x5a,0xe4,0x59,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x7c,0xaf,0x4e,
0x89,0x74,0xcd,0x90,0x42,0x74,0x96,0xbb,0x13,0xaf,0x75,0x6e,0xbf,0x19,0xfa,0x74,
0x32,0x64,0xa1,0xe4,0x79,0x3f,0xd2,0x5d,0xb9,0xce,0x30,0x14,0x0b,0xed,0xb8,0x68,
0x35,0x42,0xd0,0xd7,0x86,0x1c,0xc9,0x58,0x89,0x2f,0xd8,0xb4,0xf7,0x25,0xa4,0x6e,
0xd8,0xe4,0x07,0xd1,0x21,0x84,0x1f,0x18,0x77,0xe1,0x4e,0x2f,0xdd,0x6e,0x3e,0xdb,
0x1e,0x34,0xa8,0x64,0x43,0xab,0xcc,0xf5,0x82,0x82,0x11,0xb8,0x06,0xfe,0x85,0x81,
0x5a,0x35,0x28,0xe5,0x29,0xd7,0x69,0x78,0x3e,0x36,0x70,0x9e,0xc1,0xe3,0xf2,0xfb,
0xb1,0x4f,0xc4,0xf9,0xdd,0xec,0x80,0x04,0xc0,0xe3,0xeb,0xd2,0xa1,0xf1,0x88,0x29,
0x42,0xd6,0xed,0x97,0xe2,0xec,0x38,0x90,0x3f,0xcc,0x45,0x08,0x4f,0x2c,0xa8,0xf2,
0x13,0x8a,0x1d,0x3e,0x11,0xb9,0xe9,0x29,0xdb,0x57,0x59,0xf2,0x9b,0x99,0xac,0xc7,
0xc2,0xaf,0x88,0xd9,0x2b,0xfd,0x1f,0xb4,0x6e,0x37,0x22,0xe7,0x18,0x71,0xc5,0x1c,
0x17,0x29,0x45,0x11,0xd8,0xbb,0xef,0x11,0x83,0x4a,0x4f,0x20,0xca,0x93,0x1c,0x2e,
0x02,0x8a,0x9f,0xaa,0xfe,0x65,0x5e,0x17,0x27,0x28,0xfe,0x27,0xe7,0x13,0x2c,0x2e,
0xe5,0xcc,0xd7,0x6e,0xf8,0x03,0x70,0x75,0xda,0x21,0xf2,0xbb,0x3f,0xf6,0xd7,0x5b,
0x50,0x2f,0x57,0xff,0x9a,0x36,0x9c,0xb2,0xfa,0x74,0xcc,0x8e,0x3b,0x6b,0x51,0xd4,
0xe1,0x02,0x45,0xbc,0x00,0xb5,0xc6,0x94,0x21,0xd0,0x7d,0xc0,0xe0,0x1a,0xf0,0x28,
0xc7,0x83,0x70,0xd8,0x3a,0x1a,0x00,0x5e,0x93,0x0e,0x2c,0xd1,0x42,0xad,0xe8,0x4d,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,
0x43,0xc5,0x03,0x3b,0x13,0x4b,0x96,0x8c,0x1c,0x3b,0x03,0xdb,0xc1,0xaf,0x56,0x5a,
0xa1,0xea,0x9a,0x83,0x89,0x18,0x51,0xf4,0x35,0x2b,0x96,0xf6,0xaf,0x2b,0x1e,0x92,
0x29,0xa4,0x9e,0xcb,0xaa,0xd4,0xc0,0x2a,0x93,0x6b,0xa0,0xff,0x1e,0xf8,0x9c,0xda,
0x06,0x66,0x56,0x2f,0x70,0x7b,0x52,0x6d,0x21,0x17,0x3f,0x4f,0xfc,0xa3,0xfa,0x1a,
0xa3,0xb4,0xfe,0xf7,0xb1,0xdd,0xd6,0xb7,0x66,0x82,0xa8,0xad,0x25,0x81,0xbb,0x8e,
0xde,0x2a,0x36,0x3d,0x3e,0x32,0x56,0x6a,0x57,0x98,0x44,0xac,0xfa,0x03,0x8b,0x5f,
0x9e,0x6e,0x78,0x97,0xcc,0x45,0x12,0x39,0xa5,0x35,0xc9,0x2c,0x71,0xa0,0xaf,0xca,
0x54,0xa2,0x61,0xe6,0x60,0x20,0x7a,0xbb,0x5f,0x8e,0x0a,0x91,0x36,0x95,0xb0,0xbf,
0xec,0xc7,0x48,0x17,0xc0,0x2f,0x8a,0xaf,0xb4,0xa2,0xb6,0x01,0x28,0xdf,0x40,0xe3,
0x81,0x47,0x2b,0xea,0xe9,0xcf,0x50,0xed,0x6c,0x39,0xb5,0xe6,0x76,0x14,0x85,0x18,
0xb0,0x3f,0x0d,0x3c,0x6f,0x31,0xe1,0x2b,0xbd,0xc2,0x7e,0x83,0x98,0x5d,0x00,0x97,
0xdb,0x0a,0x85,0x54,0x09,0x12,0x1b,0xab,0xe4,0x1c,0x86,0x7e,0xdf,0xd0,0xd6,0xd9,
0x9d,0xbf,0x57,0xe0,0x16,0xf9,0xdf,0x9c,0x65,0x7a,0xb3,0x1d,0x9f,0x06,0xd8,0xcd,
0xaf,0xb6,0x61,0x45,0xef,0x85,0x8d,0x9d,0xe9,0xb2,0x47,0x05,0x38,0xea,0xbc,0x97,
0xb7,0xb9,0x5a,0x2c,0xd6,0xeb,0x7e,0x18,0x32,0x8f,0xc2,0x83,0x32,0x1a,0xf4,0x70,
0x56,0x62,0x74,0x2b,0x8d,0xe1,0x92,0x84,0x3e,0xc2,0xcb,0x91,0xe0,0x4b,0x4c,0xfb
};

const unsigned char test2[] = {
0x3e,0x43,0xd2,0xac,0x6e,0xaf,0x63,0x62,0xd0,0x50,0x87,0x89,0x0a,0xd8,0x45,0xf7,
0x46,0x0c,0x0a,0x25,0x75,0xf2,0x3e,0xe8,0x3b,0x15,0x90,0x93,0x30,0xf0,0x26,0xe8,
0x70,0xd0,0x5b,0xf9,0x7e,0x26,0xce,0x58,0xb7,0x0b,0xda,0xe6,0x55,0x8e,0x0f,0x7e,
0x41,0x30,0x7b,0x2f,0xbd,0xef,0xf1,0xec,0x4b,0x7d,0x08,0xec,0xa9,0x76,0x00,0xd8,
0xf9,0xb5,0xf9,0xc7,0x23,0x3f,0x76,0xce,0xfd,0x26,0xa4,0x85,0x1f,0xaa,0x9f,0xfb,
0xdb,0x10,0x67,0x67,0x17,0xc5,0x48,0x5a,0xc1,0xa1,0x20,0xbd,0x2b,0x93,0xd5,0x22,
0x42,0x4b,0x6d,0xbd,0xeb,0x4b,0x53,0x9e,0xed,0x67,0xcf,0x0f,0x72,0x58,0xf5,0xa5,
0x7a,0x88,0x7d,0x55,0xdd,0x04,0xf8,0x65,0x0b,0xfc,0x59,0xd1,0x3c,0x79,0x44,0x94,
0x95,0x84,0x9e,0xd0,0xf6,0x48,0xca,0x60,0xd4,0x29,0x06,0x47,0x56,0xb5,0x61,0xea,
0x0d,0x7a,0xb5,0x45,0x1a,0x0a,0x47,0x7f,0x28,0x01,0x3d,0x4f,0x10,0x03,0x25,0x98,
0x43,0xfb,0x49,0x51,0xa1,0xf5,0x73,0xe9,0xb1,0x19,0x25,0xb3,0xaf,0x47,0xa1,0x92,
0x43,0x16,0xae,0x15,0xf1,0x08,0x7e,0x87,0xf6,0x44,0xaf,0x7e,0x6c,0xa7,0xd8,0xfa,
0x86,0xa8,0x17,0x00,0x9b,0x9c,0xd6,0xc4,0x07,0x5d,0xed,0x10,0x47,0x8e,0x2f,0x4d,
0xc1,0x3a,0x16,0xec,0x56,0xe2,0xa3,0x6d,0xf4,0x79,0x6a,0xba,0xcf,0x77,0xc9,0x25,
0x54,0x13,0x4d,0x0d,0x25,0xbd,0x0b,0x74,0xe8,0x63,0x46,0x35,0x87,0x09,0x43,0x93,
0xd7,0xf7,0x25,0xf4,0x1b,0x97,0x60,0xeb,0xa6,0xcb,0xd7,0x26,0xdd,0x75,0x4c,0xbc
};

const unsigned char test2_result[] = {
0x76,0x14,0xf9,0xe6,0x04,0x8b,0x22,0x61,0x01,0xb1,0xba,0xd4,0xe5,0x64,0x57,0x3c,
0xbd,0x72,0x6c,0x21,0xd4,0x05,0x6a,0x9d,0x6f,0xcf,0x18,0x63,0xc7,0x0a,0x16,0x00,
0x1c,0x36,0xac,0x30,0x95,0xa0,0x15,0x8c,0xa9,0x70,0xbf,0x64,0x64,0x99,0xc1,0xb7,
0x45,0xab,0x93,0x6d,0x31,0x42,0x17,0xbe,0x53,0xfc,0xbd,0x5c,0xc6,0x65,0xef,0xb6,
0x65,0x01,0x97,0x8d,0x81,0x0d,0x7e,0xc0,0x4d,0x07,0x7e,0x4a,0xbf,0xf7,0xba,0x12,
0xff,0x70,0x8b,0x53,0xa3,0xb9,0x32,0x76,0x8f,0xaf,0xec,0x61,0xde,0xac,0xe0,0x80,
0x9b,0x2a,0xc0,0xca,0xa2,0x37,0x16,0x00,0x59,0x4e,0x07,0xde,0xf5,0x5e,0xb9,0xb7,
0xa3,0xc3,0x8b,0x4b,0x9b,0xed,0xb5,0xec,0x35,0x42,0xe5,0x95,0xca,0x6a,0x23,0x74,
0x3e,0xf8,0x0b,0xc6,0xf8,0x35,0xb5,0xe0,0xa5,0xc1,0x4c,0xfd,0x90,0x08,0xfe,0x5d,
0xde,0x0e,0x64,0xf4,0xf2,0xde,0x5a,0xd4,0xdf,0x6f,0x08,0x23,0xaf,0xc0,0x69,0xee,
0xb3,0xbf,0x4b,0x7c,0xfd,0x33,0xdd,0x20,0x5a,0x8f,0x6f,0x04,0xf9,0x50,0x36,0x53,
0xa5,0x23,0xd1,0x6b,0xff,0xb5,0xf8,0xd2,0x8d,0x89,0xe3,0xd0,0x4d,0xb3,0xf4,0x37,
0x81,0x14,0xe2,0xc1,0x3a,0x75,0x56,0x58,0x0d,0xf7,0x01,0x3d,0xd8,0x73,0xf1,0x2a,
0xf7,0x00,0xfc,0x58,0x0e,0x77,0x3f,0x09,0xde,0x1f,0xe5,0x9b,0x14,0xff,0x8f,0x0c,
0x45,0xcd,0x43,0xcc,0x0f,0x2f,0x60,0x6d,0x06,0x70,0xd7,0x61,0xf6,0x52,0xc4,0xf5,
0x79,0x65,0x54,0xd4,0x4e,0x05,0x12,0xc7,0x33,0xcc,0x1f,0x65,0x77,0xe3,0xb1,0xd6,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,0x00,0x7c,0xaf,0x4e,
0x89,0x74,0xcd,0x90,0x42,0x74,0x96,0xbb,0x13,0xaf,0x75,0x6e,0xbf,0x19,0xfa,0x74,
0x32,0x64,0xa1,0xe4,0x79,0x3f,0xd2,0x5d,0xb9,0xce,0x30,0x14,0x0b,0xed,0xb8,0x68,
0x35,0x42,0xd0,0xd7,0x86,0x1c,0xc9,0x58,0x89,0x2f,0xd8,0xb4,0xf7,0x25,0xa4,0x6e,
0xd8,0xe4,0x07,0xd1,0x21,0x84,0x1f,0x18,0x77,0xe1,0x4e,0x2f,0xdd,0x6e,0x3e,0xdb,
0x1e,0x34,0xa8,0x64,0x43,0xab,0xcc,0xf5,0x82,0x82,0x11,0xb8,0x06,0xfe,0x85,0x81,
0x5a,0x35,0x28,0xe5,0x29,0xd7,0x69,0x78,0x3e,0x36,0x70,0x9e,0xc1,0xe3,0xf2,0xfb,
0xb1,0x4f,0xc4,0xf9,0xdd,0xec,0x80,0x04,0xc0,0xe3,0xeb,0xd2,0xa1,0xf1,0x88,0x29,
0x42,0xd6,0xed,0x97,0xe2,0xec,0x38,0x90,0x3f,0xcc,0x45,0x08,0x4f,0x2c,0xa8,0xf2,
0x13,0x8a,0x1d,0x3e,0x11,0xb9,0xe9,0x29,0xdb,0x57,0x59,0xf2,0x9b,0x99,0xac,0xc7,
0xc2,0xaf,0x88,0xd9,0x2b,0xfd,0x1f,0xb4,0x6e,0x37,0x22,0xe7,0x18,0x71,0xc5,0x1c,
0x17,0x29,0x45,0x11,0xd8,0xbb,0xef,0x11,0x83,0x4a,0x4f,0x20,0xca,0x93,0x1c,0x2e,
0x02,0x8a,0x9f,0xaa,0xfe,0x65,0x5e,0x17,0x27,0x28,0xfe,0x27,0xe7,0x13,0x2c,0x2e,
0xe5,0xcc,0xd7,0x6e,0xf8,0x03,0x70,0x75,0xda,0x21,0xf2,0xbb,0x3f,0xf6,0xd7,0x5b,
0x50,0x2f,0x57,0xff,0x9a,0x36,0x9c,0xb2,0xfa,0x74,0xcc,0x8e,0x3b,0x6b,0x51,0xd4,
0xe1,0x02,0x45,0xbc,0x00,0xb5,0xc6,0x94,0x21,0xd0,0x7d,0xc0,0xe0,0x1a,0xf0,0x28,
0xc7,0x83,0x70,0xd8,0x3a,0x1a,0x00,0x5e,0x93,0x0e,0x2c,0xd1,0x42,0xad,0xe8,0x4d,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x01,
0x43,0xc5,0x03,0x3b,0x13,0x4b,0x96,0x8c,0x1c,0x3b,0x03,0xdb,0xc1,0xaf,0x56,0x5a,
0xa1,0xea,0x9a,0x83,0x89,0x18,0x51,0xf4,0x35,0x2b,0x96,0xf6,0xaf,0x2b,0x1e,0x92,
0x29,0xa4,0x9e,0xcb,0xaa,0xd4,0xc0,0x2a,0x93,0x6b,0xa0,0xff,0x1e,0xf8,0x9c,0xda,
0x06,0x66,0x56,0x2f,0x70,0x7b,0x52,0x6d,0x21,0x17,0x3f,0x4f,0xfc,0xa3,0xfa,0x1a,
0xa3,0xb4,0xfe,0xf7,0xb1,0xdd,0xd6,0xb7,0x66,0x82,0xa8,0xad,0x25,0x81,0xbb,0x8e,
0xde,0x2a,0x36,0x3d,0x3e,0x32,0x56,0x6a,0x57,0x98,0x44,0xac,0xfa,0x03,0x8b,0x5f,
0x9e,0x6e,0x78,0x97,0xcc,0x45,0x12,0x39,0xa5,0x35,0xc9,0x2c,0x71,0xa0,0xaf,0xca,
0x54,0xa2,0x61,0xe6,0x60,0x20,0x7a,0xbb,0x5f,0x8e,0x0a,0x91,0x36,0x95,0xb0,0xbf,
0xec,0xc7,0x48,0x17,0xc0,0x2f,0x8a,0xaf,0xb4,0xa2,0xb6,0x01,0x28,0xdf,0x40,0xe3,
0x81,0x47,0x2b,0xea,0xe9,0xcf,0x50,0xed,0x6c,0x39,0xb5,0xe6,0x76,0x14,0x85,0x18,
0xb0,0x3f,0x0d,0x3c,0x6f,0x31,0xe1,0x2b,0xbd,0xc2,0x7e,0x83,0x98,0x5d,0x00,0x97,
0xdb,0x0a,0x85,0x54,0x09,0x12,0x1b,0xab,0xe4,0x1c,0x86,0x7e,0xdf,0xd0,0xd6,0xd9,
0x9d,0xbf,0x57,0xe0,0x16,0xf9,0xdf,0x9c,0x65,0x7a,0xb3,0x1d,0x9f,0x06,0xd8,0xcd,
0xaf,0xb6,0x61,0x45,0xef,0x85,0x8d,0x9d,0xe9,0xb2,0x47,0x05,0x38,0xea,0xbc,0x97,
0xb7,0xb9,0x5a,0x2c,0xd6,0xeb,0x7e,0x18,0x32,0x8f,0xc2,0x83,0x32,0x1a,0xf4,0x70,
0x56,0x62,0x74,0x2b,0x8d,0xe1,0x92,0x84,0x3e,0xc2,0xcb,0x91,0xe0,0x4b,0x4c,0xfb
};



int p2_test()
{
    int lres = 0;
    memcpy(ps_encrypt_buf,test1,sizeof(test1));
    logd("test1:"); dumpd(ps_encrypt_buf,sizeof(test1));
    p2_doit(ps_encrypt_buf, ps_encrypt_buf);
    logd("test1_result:"); dumpd(ps_encrypt_buf,sizeof(test1_result));

    lres += ((memcmp(ps_encrypt_buf, test1_result, sizeof(test1_result)) == 0) ? 1 : 0);
    memcpy(ps_encrypt_buf,test2,sizeof(test2));
    // p2_doit(ps_encrypt_buf, ps_encrypt_buf);
    // lres += ((memcmp(ps_encrypt_buf, test2_result, sizeof(test2_result)) == 0) ? 1 : 0);
    return lres;
}
#endif

#endif